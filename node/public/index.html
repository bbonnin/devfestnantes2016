<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Devfest Nantes 2016 : EclairJS</title>
  <link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css">
</head>

<body>
  <h2>EclairJS <small>examples</small></h2>

  <div id="eclairjs">
    <div v-show="error && !running" class="alert alert-danger">{{ error }}</div>

    <div v-show="running" class="alert alert-warning">{{ running }} is running...</div>

    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">SQL</h3>
      </div>
      <div class="panel-body">
        <form class="form-inline">
          <button class="btn btn-primary" :disabled="running" @click="runSQL">Run</button>
          <input type="text" class="form-control" v-model="query" style="min-width: 50%">
        </form>
        <p>
          <table v-if="queryRes && queryRes.length > 0" class="table">
            <tr><th v-for="(val, key) in queryRes[0]">{{ key }}</th></tr>
            <tr v-for="row in queryRes">
              <td v-for="(val, key) in queryRes[0]">{{ row[key] }}</td>
            </tr>
          </table>
        </p>
      </div>
    </div>

    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">Word count</h3>
      </div>
      <div class="panel-body">
        <button class="btn btn-primary" :disabled="running" @click="runWordCount">Run</button>
        <p>
          <table v-show="wordcounts" class="table">
            <tr><th>Word</th><th>Count</th></tr>
            <tr v-for="count in wordcounts"><td>{{ count['1'] }}</td><td>{{ count['0'] }}</td></tr>
          </table>
        </p>
      </div>
    </div>
  </div>

  <script src="vue/dist/vue.min.js"></script>
  <script src="vue-resource/dist/vue-resource.min.js"></script>
  <script>
  new Vue({
    el: '#eclairjs',

    data: {
      running: null,
      error: false,
      wordcounts: null,
      query: 'SELECT * FROM people',
      queryRes: null
    },

    methods: {
      reinit: function (test) {
        this.running = test
        this.error = false
        this.wordcounts = null
        this.queryRes = null
      },

      runSQL: function () {
        this.reinit('SQL')
        this.$http.post('/sql', { query: this.query })
        .then(response => {
          this.queryRes = response.data.result
        }, err => {
          this.error = err.body
        })
        .finally(() => {
          this.running = null
        })
      },

      runWordCount: function () {
        this.reinit('WORD COUNT')
        this.$http.get('/wordcount')
        .then(response => {
          this.wordcounts = response.data.result
        }, err => {
          this.error = err.body
        })
        .finally(() => {
          this.running = null
        })
      }
    }
  })
  </script>
</body>
</html>
